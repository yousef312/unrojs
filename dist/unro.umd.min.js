!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).unro={})}(this,function(t){"use strict";const e=["clearpath","insertion","lineare"],n=()=>{};let r=0;Array.prototype.insert=function(t,e){var n,r,i;return this.splice((n=e,r=0,i=this.length,n<r?r:n>i?i:n),0,t),e};class i{#t=[];#e=null;#n=!1;#r=!1;#i=[];#s=null;constructor(){this.current=-1,this.maximum=100,this.algo="clearpath";this.#s=(()=>{let t,e,n,r;return{use:e=>{if(!(e instanceof OffscreenCanvasRenderingContext2D||e instanceof CanvasRenderingContext2D))throw new Error('UnroJs Definition Error\n Parameter passed in ".use" function must be of type OffscreenCanvasRenderingContext2D or CanvasRenderingContext2D');t=e},label:t=>e=t,register:(e,i)=>{if(!(t||i&&(i instanceof OffscreenCanvasRenderingContext2D||i instanceof CanvasRenderingContext2D)))throw new Error('UnroJs Defintion Error\n ".register" is missing the source parameter');const s=i||t;switch(e){case"undo":n=s.getImageData(0,0,s.canvas.width,s.canvas.height);break;case"redo":r=s.getImageData(0,0,s.canvas.width,s.canvas.height)}},process:function(){if(!(this instanceof i))throw new Error('UnroJs Error\n".process" function is only callable from within Unro class');if(!n||!r||!t)throw new Error('UnroJs Definition Error\n Definition is missing "undo" or "redo" stacks or destination CanvasContext! make sure to call ".register(stack)" and ".use(dst)" from within the maker');let o=new s({undo:function(){this.load("source").putImageData(this.load("undo"),0,0)},redo:function(){this.load("source").putImageData(this.load("redo"),0,0)},label:e});return o.save("source",t),o.save("undo",n),o.save("redo",r),o},kill:function(){if(!(this instanceof i))throw new Error('UnroJs Error\n".kill" function is only callable from within Unro class');r=n=e=t=void 0}}})()}get lastAction(){return this.#e}get isFirstStack(){return!0===this.#r}get isLastStack(){return!0===this.#n}push(t,e){if(!t||"[object Object]"!==t.toString()&&!["string","function"].includes(typeof t))return;if("string"==typeof t){let n=this.#i.find(e=>e.label===t);if(!n)return;t={undo:function(){n.undo(e)},redo:function(){n.redo(e)}}}let n;if("function"==typeof t)t(this.#s),n=this.#s.process.call(this),this.#s.kill.call(this);else{if("function"!=typeof t.undo||"function"!=typeof t.redo)throw new Error("[UnroJS] wrong stack defintion in .push, a stack must have undo & redo or init functions");n=new s(t)}let r=this.current;return"lineare"===this.algo?this.current=this.#t.push(n)-1:"clearpath"===this.algo?(void 0!==this.#t[r+1]&&this.#t.splice(r+1,this.#t.length),this.current=this.#t.push(n)-1):"insertion"===this.algo&&(this.current=this.#t.insert(n,r+1)),this.#t.length>this.maximum&&(this.#t.shift(),this.current=r),this.#r=!1,this.current}undo(){if(!this.#r)return this.#e="undo",this.#t[this.current].undo(this),this.current>-2&&this.current--,this.current<0?this.#r=!0:(this.#n=!1,this)}redo(){return this.#t[this.current+1]?(this.current++,this.#t[this.current].redo(this),this.#e="redo",this.#r=!1,this):this.#n=!0}expand(t){return this.maximum="number"==typeof t?t:this.maximum,this}free(){return this.#t=[],this.current=0,this}moveTo(t){if(t===this.current)return"current";if(this.#t[t]){if(t>this.current)for(let e=this.current+1;e<=t;e++)this.current=e,this.#t[e].redo(this);else for(let e=this.current;e>=t;e--)this.current=e,this.#t[e].undo(this);return this.current=t,this.#t[t]}return"out-of-range"}setAlgorithme(t){return!!e.includes(t)&&(this.algo=t,!0)}exportStackActions(){let t=[];return this.#t.forEach(e=>t.push({action:e.label,date:e.date})),JSON.stringify({stacks:t})}acquire(t,e){if(t.bind){let n=this,r="ctrl+w",i="ctrl+y";"b"==e&&(r="ctrl+w",i="ctrl+shift+y"),t.bind(r,function(){n.undo()}),t.bind(i,function(){n.redo()})}return this}defineHandler(t){if("[object Object]"!==t.toString()||"string"!=typeof t.label||"function"!=typeof t.undo||"function"!=typeof t.redo)throw new Error('UnroJs Error\n trying to use ".defineHandler" function with wrong parameter type or structure!');this.#i.push(t)}removeHandler(t){if("string"==typeof t){let e=this.#i.findIndex(e=>e.label===t);if(-1!=e)return this.#i.splice(e,1),!0}return!1}hasHandler(t){return-1!=this.#i.findIndex(e=>e.label===t)}get len(){return this.#t.length}}class s{#o=n;#a=n;#u={};#h=++r;constructor(t){this.#o=t.undo,this.#a=t.redo,this.date=new Date,this.label=t.label}get undo(){return this.#o}get redo(){return this.#a}get id(){return this.#h}save(t,e){"string"==typeof t&&null!=e&&(this.#u[t]=e)}load(t){return t?this.#u[t]:{...this.#u}}}function o(){return new i}window.unro=o,t.Unro=i,t.default=o,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=unro.umd.min.js.map
