!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).unro={})}(this,function(t){"use strict";const e=["clearpath","insertion","lineare"],n=()=>{};let r=0;Array.prototype.insert=function(t,e){var n,r,s;return this.splice((n=e,r=0,s=this.length,n<r?r:n>s?s:n),0,t),e};class s{#t=[];#e=null;#n=!1;#r=!1;#s=[];#i=null;#o={on:!1,list:[]};constructor(){this.current=-1,this.maximum=100,this.algo="clearpath";this.#i=(()=>{let t,e,n,r,o,a;return{use:e=>{if(!(e instanceof OffscreenCanvasRenderingContext2D||e instanceof CanvasRenderingContext2D))throw new Error('UnroJs Definition Error\n Parameter passed in ".use" function must be of type OffscreenCanvasRenderingContext2D or CanvasRenderingContext2D');t=e},label:t=>e=t,register:(e,s)=>{if(!(t||s&&(s instanceof OffscreenCanvasRenderingContext2D||s instanceof CanvasRenderingContext2D)))throw new Error('UnroJs Defintion Error\n ".register" is missing the source parameter');const i=s||t;switch(e){case"undo":n=i instanceof ImageData?i:i.getImageData(0,0,i.canvas.width,i.canvas.height);break;case"redo":r=i instanceof ImageData?i:i.getImageData(0,0,i.canvas.width,i.canvas.height)}},after:(t,e)=>{"undo"===t&&"function"==typeof e?o=e:"redo"===t&&"function"==typeof e?a=e:"function"==typeof t&&(o=a=t)},process:function(){if(!(this instanceof s))throw new Error('UnroJs Error\n".process" function is only callable from within Unro class');if(!n||!r||!t)throw new Error('UnroJs Definition Error\n Definition is missing "undo" or "redo" stacks or destination CanvasContext! make sure to call ".register(stack)" and ".use(dst)" from within the maker');let h=new i({undo:function(){this.load("source").putImageData(this.load("undo"),0,0),this.load("undo-cb")&&this.load("undo-cb")()},redo:function(){this.load("source").putImageData(this.load("redo"),0,0),this.load("redo-cb")&&this.load("redo-cb")()},label:e});return h.save("source",t),h.save("undo",n),h.save("redo",r),"function"==typeof o&&h.save("undo-cb",o),"function"==typeof a&&h.save("redo-cb",a),h},kill:function(){if(!(this instanceof s))throw new Error('UnroJs Error\n".kill" function is only callable from within Unro class');r=n=e=t=void 0}}})()}get lastAction(){return this.#e}get isFirstStack(){return!0===this.#r}get isLastStack(){return!0===this.#n}push(t,e){if(!t||"[object Object]"!==t.toString()&&!["string","function"].includes(typeof t))return;if("string"==typeof t){let n=this.#s.find(e=>e.label===t);if(!n)return;t={undo:function(){n.undo(e)},redo:function(){n.redo(e)}}}let n;if("function"==typeof t)t(this.#i),n=this.#i.process.call(this),this.#i.kill.call(this);else{if("function"!=typeof t.undo||"function"!=typeof t.redo)throw new Error("[UnroJS] wrong stack defintion in .push, a stack must have undo & redo or init functions");n=new i(t)}if(this.#o.on)return this.#o.list.push(n);let r=this.current;return"lineare"===this.algo?this.current=this.#t.push(n)-1:"clearpath"===this.algo?(void 0!==this.#t[r+1]&&this.#t.splice(r+1,this.#t.length),this.current=this.#t.push(n)-1):"insertion"===this.algo&&(this.current=this.#t.insert(n,r+1)),this.#t.length>this.maximum&&(this.#t.shift(),this.current=r),this.#r=!1,this.current}bigPush(t){if("function"!=typeof t)return;this.#o.on=!0,this.#o.list=[],t();const e=[...this.#o.list];e.length||console.warn("UnroJs warn\nbigPush method was called but no stacks was created! \n consider review usage documentation!");let n=this.current;return"lineare"===this.algo?this.current=this.#t.push(e)-1:"clearpath"===this.algo?(void 0!==this.#t[n+1]&&this.#t.splice(n+1,this.#t.length),this.current=this.#t.push(e)-1):"insertion"===this.algo&&(this.current=this.#t.insert(e,n+1)),this.#t.length>this.maximum&&(this.#t.shift(),this.current=n),this.#r=!1,this.#o.on=!1,this.#o.list=[],this.current}undo(){if(!this.#r)return this.#e="undo",(Array.isArray(this.#t[this.current])?this.#t[this.current]:[this.#t[this.current]]).forEach(t=>t.undo(this)),this.current>-2&&this.current--,this.current<0?this.#r=!0:(this.#n=!1,this)}redo(){return this.#t[this.current+1]?(this.current++,(Array.isArray(this.#t[this.current])?this.#t[this.current]:[this.#t[this.current]]).forEach(t=>t.redo(this)),this.#e="redo",this.#r=!1,this):this.#n=!0}expand(t){return this.maximum="number"==typeof t?t:this.maximum,this}free(){return this.#t=[],this.current=0,this}moveTo(t){if(t===this.current)return"current";if(this.#t[t]){if(t>this.current)for(let e=this.current+1;e<=t;e++)this.current=e,this.#t[e].redo(this);else for(let e=this.current;e>=t;e--)this.current=e,this.#t[e].undo(this);return this.current=t,this.#t[t]}return"out-of-range"}setAlgorithme(t){return!!e.includes(t)&&(this.algo=t,!0)}exportStackActions(){let t=[];return this.#t.forEach(e=>t.push({action:e.label,date:e.date})),JSON.stringify({stacks:t})}acquire(t,e){if(t.bind){let n=this,r="ctrl+w",s="ctrl+y";"b"==e&&(r="ctrl+w",s="ctrl+shift+y"),t.bind(r,function(){n.undo()}),t.bind(s,function(){n.redo()})}return this}defineHandler(t){if("[object Object]"!==t.toString()||"string"!=typeof t.label||"function"!=typeof t.undo||"function"!=typeof t.redo)throw new Error('UnroJs Error\n trying to use ".defineHandler" function with wrong parameter type or structure!');this.#s.push(t)}removeHandler(t){if("string"==typeof t){let e=this.#s.findIndex(e=>e.label===t);if(-1!=e)return this.#s.splice(e,1),!0}return!1}hasHandler(t){return-1!=this.#s.findIndex(e=>e.label===t)}get len(){return this.#t.length}}class i{#a=n;#h=n;#c={};#u=++r;constructor(t){this.#a=t.undo,this.#h=t.redo,this.date=new Date,this.label=t.label}get undo(){return this.#a}get redo(){return this.#h}get id(){return this.#u}save(t,e){"string"==typeof t&&null!=e&&(this.#c[t]=e)}load(t){return t?this.#c[t]:{...this.#c}}}function o(){return new s}window.unro=o,t.Unro=s,t.default=o,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=unro.umd.min.js.map
