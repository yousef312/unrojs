!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).unro=e()}(this,function(){"use strict";const t=["clearpath","insertion","lineare"],e=()=>{};let r=0;Array.prototype.insert=function(t,e){var r,n,i;return this.splice((r=e,n=0,i=this.length,r<n?n:r>i?i:r),0,t),e};class n{#t=e;#e=e;#r=null;#n=null;#i=null;#s=!1;#h=++r;constructor(t){this.#t=t.undo,this.#e=t.redo,this.date=new Date,this.label=t.label,t.renderer2D instanceof CanvasRenderingContext2D&&(this.#r=t.renderer2D,this.#n=[])}get undo(){return this.#t}get redo(){return this.#e}get isReady(){return this.#s}get id(){return this.#h}save(t){null!=t&&(this.#i=t)}load(){return this.#i}copy(){if(!this.#r)throw new Error("[UnroJS] Define .renderer2D in order to use canvas copy/paste features.");if(this.#n.length<=2){let t=new OffscreenCanvas(this.#r.canvas.width,this.#r.canvas.height).getContext("2d");if(t.drawImage(this.#r.canvas,0,0),this.#n.push(t),2==this.#n.length){this.#s=!0;let t=this.#t,e=this.#e;this.#t=function(){this.paste("undo"),"function"==typeof t&&t()},this.#e=function(){this.paste("redo"),"function"==typeof e&&e()}}}}paste(t){if(!this.#r)throw new Error("[UnroJS] Define .renderer2D in order to use canvas copy/paste features.");let e=this.#n[[1,"undo"].includes(t)?0:[2,"redo"].includes(t)?1:-1];if(!e)throw new Error(`[UnroJS] Unknown "step" in .paste "${t}"`);this.#r.clearRect(0,0,this.#r.canvas.width,this.#r.canvas.height),this.#r.drawImage(e.canvas,0,0)}}const i=new class{#o=[];constructor(e,r){this.current=-1,this.maximum="number"==typeof e?e:100,this.algo=t.includes(r)?r:"clearpath"}push(t){if(!t||"[object Object]"!==t.toString())return;let e=new n(t);if("function"==typeof t.init){if(t.init(e),!e.isReady)throw new Error("[UnroJS] the .init function not well constructed")}else if("function"!=typeof t.undo||"function"!=typeof t.redo)throw new Error("[UnroJS] wrong stack defintion in .push, a stack must have undo & redo or init functions");let r=this.current;return"lineare"===this.algo?this.current=this.#o.push(e)-1:"clearpath"===this.algo?(void 0!==this.#o[r+1]&&this.#o.splice(r+1,this.#o.length),this.current=this.#o.push(e)-1):"insertion"===this.algo&&(this.current=this.#o.insert(e,r+1)),this.#o.length>this.maximum&&(this.#o.shift(),this.current=r),this.current}undo(){return this.#o[this.current].undo(this),this.#o[this.current-1]&&this.current--,this}redo(){return this.#o[this.current].redo(this),this.#o[this.current+1]&&this.current++,this}expand(t){return this.maximum="number"==typeof t?t:this.maximum,this}free(){return this.#o=[],this.current=0,this}moveTo(t){if(t===this.current)return"current";if(this.#o[t]){if(t>this.current)for(let e=this.current+1;e<=t;e++)this.current=e,this.#o[e].redo(this);else for(let e=this.current;e>=t;e--)this.current=e,this.#o[e].undo(this);return this.current=t,this.#o[t]}return"out-of-range"}setAlgorithme(e){return!!t.includes(e)&&(this.algo=e,!0)}exportStackActions(){let t=[];return this.#o.forEach(e=>t.push({action:e.label,date:e.date})),JSON.stringify({stacks:t})}acquire(t,e){if(t.bind){let r=this,n="ctrl+w",i="ctrl+y";"b"==e&&(n="ctrl+w",i="ctrl+shift+y"),t.bind(n,function(){r.undo()}),t.bind(i,function(){r.redo()})}}get len(){return this.#o.length}};return window.Unro=i,i});
//# sourceMappingURL=unro.umd.min.js.map
