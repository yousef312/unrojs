!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).unro={})}(this,function(t){"use strict";const e=["clearpath","insertion","lineare"],r=()=>{};let n=0;Array.prototype.insert=function(t,e){var r,n,i;return this.splice((r=e,n=0,i=this.length,r<n?n:r>i?i:r),0,t),e};class i{#t=[];#e=null;#r=!1;#n=!1;#i=[];constructor(){this.current=-1,this.maximum=100,this.algo="clearpath"}get lastAction(){return this.#e}get isFirstStack(){return!0===this.#n}get isLastStack(){return!0===this.#r}push(t,e){if(!t||"[object Object]"!==t.toString()&&"string"!=typeof t)return;if("string"==typeof t){let r=this.#i.find(e=>e.label===t);if(!r)return;t={undo:function(){r.undo(e)},redo:function(){r.redo(e)}}}let r=new s(t);if("function"==typeof t.init){if(t.init(r),!r.isReady)throw new Error("[UnroJS] the .init function not well constructed")}else if("function"!=typeof t.undo||"function"!=typeof t.redo)throw new Error("[UnroJS] wrong stack defintion in .push, a stack must have undo & redo or init functions");let n=this.current;return"lineare"===this.algo?this.current=this.#t.push(r)-1:"clearpath"===this.algo?(void 0!==this.#t[n+1]&&this.#t.splice(n+1,this.#t.length),this.current=this.#t.push(r)-1):"insertion"===this.algo&&(this.current=this.#t.insert(r,n+1)),this.#t.length>this.maximum&&(this.#t.shift(),this.current=n),this.current}undo(){if(!this.#n)return this.#e="undo",this.#t[this.current].undo(this),this.current>-2&&this.current--,this.current<0?this.#n=!0:(this.#r=!1,this)}redo(){return this.#t[this.current+1]?(this.current++,this.#t[this.current].redo(this),this.#e="redo",this.#n=!1,this):this.#r=!0}expand(t){return this.maximum="number"==typeof t?t:this.maximum,this}free(){return this.#t=[],this.current=0,this}moveTo(t){if(t===this.current)return"current";if(this.#t[t]){if(t>this.current)for(let e=this.current+1;e<=t;e++)this.current=e,this.#t[e].redo(this);else for(let e=this.current;e>=t;e--)this.current=e,this.#t[e].undo(this);return this.current=t,this.#t[t]}return"out-of-range"}setAlgorithme(t){return!!e.includes(t)&&(this.algo=t,!0)}exportStackActions(){let t=[];return this.#t.forEach(e=>t.push({action:e.label,date:e.date})),JSON.stringify({stacks:t})}acquire(t,e){if(t.bind){let r=this,n="ctrl+w",i="ctrl+y";"b"==e&&(n="ctrl+w",i="ctrl+shift+y"),t.bind(n,function(){r.undo()}),t.bind(i,function(){r.redo()})}return this}defineHandler(t){if("[Object object]"!==t.toString()||"string"!=typeof t.label||"function"!=typeof t.undo||"function"!=typeof t.redo)throw new Error('UnroJs Error\n trying to use ".define" function with wrong parameter type or structure!');this.#i.push(t)}removeHandler(t){if("string"==typeof t){let e=this.#i.findIndex(e=>e.label===t);if(-1!=e)return this.#i.splice(e,1),!0}return!1}hasHandler(t){return-1!=this.#i.findIndex(e=>e.label===t)}get len(){return this.#t.length}}class s{#s=r;#o=r;#h=null;#a=null;#u=null;#c=!1;#d=++n;constructor(t){this.#s=t.undo,this.#o=t.redo,this.date=new Date,this.label=t.label,(t.renderer2D instanceof CanvasRenderingContext2D||t.renderer2D instanceof OffscreenCanvasRenderingContext2D)&&(this.#h=t.renderer2D,this.#a=[])}get undo(){return this.#s}get redo(){return this.#o}get isReady(){return this.#c}get id(){return this.#d}save(t){null!=t&&(this.#u=t)}load(){return this.#u}copy(){if(!this.#h)throw new Error("[UnroJS] Define .renderer2D in order to use canvas copy/paste features.");if(this.#a.length<=2){let t=new OffscreenCanvas(this.#h.canvas.width,this.#h.canvas.height).getContext("2d");if(t.drawImage(this.#h.canvas,0,0),this.#a.push(t),2==this.#a.length){this.#c=!0;let t=this.#s,e=this.#o;this.#s=function(){this.paste("undo"),"function"==typeof t&&t()},this.#o=function(){this.paste("redo"),"function"==typeof e&&e()}}}}paste(t){if(!this.#h)throw new Error("[UnroJS] Define .renderer2D in order to use canvas copy/paste features.");let e=this.#a[[1,"undo"].includes(t)?0:[2,"redo"].includes(t)?1:-1];if(!e)throw new Error(`[UnroJS] Unknown "step" in .paste "${t}"`);this.#h.clearRect(0,0,this.#h.canvas.width,this.#h.canvas.height),this.#h.drawImage(e.canvas,0,0)}}function o(){return new i}window.unro=o,t.Unro=i,t.default=o,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=unro.umd.min.js.map
